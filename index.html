<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 家族旅遊計畫</title>
    <!-- 引入樣式與腳本庫 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // --- 完整行程數據 ---
        const fullItinerary = [
            { id: 'day1', date: '2026-02-11', dayText: 'Day 1', city: '大阪', spots: [{ id: 's1-1', name: '桃園機場 CI156 (08:10-11:35)', duration: '航班', travelTime: '0' }, { id: 's1-2', name: '大阪港 名門大洋渡輪 (19:50發)', duration: '登船', travelTime: '60' }] },
            { id: 'day2', date: '2026-02-12', dayText: 'Day 2', city: '下關/防府', spots: [{ id: 's2-1', name: '唐戶市場', duration: '海鮮美食', travelTime: '30' }, { id: 's2-2', name: '海峽夢之塔', duration: '展望台', travelTime: '15' }, { id: 's2-3', name: '關門隧道步道', duration: '跨海步行', travelTime: '20' }, { id: 's2-4', name: '防府天滿宮', duration: '神社', travelTime: '45' }] },
            { id: 'day3', date: '2026-02-13', dayText: 'Day 3', city: '岩國/宮島', spots: [{ id: 's3-1', name: '錦帶橋', duration: '木造橋', travelTime: '40' }, { id: 's3-2', name: '岩國城', duration: '天守閣', travelTime: '20' }, { id: 's3-3', name: '嚴島神社 (大鳥居)', duration: '世界遺產', travelTime: '60' }, { id: 's3-4', name: '宮島表參道商店街', duration: '購物/點心', travelTime: '10' }] },
            { id: 'day4', date: '2026-02-14', dayText: 'Day 4', city: '廣島', spots: [{ id: 's4-1', name: '原爆圓頂', duration: '歷史遺跡', travelTime: '30' }, { id: 's4-2', name: '和平紀念公園', duration: '散步', travelTime: '5' }] },
            { id: 'day5', date: '2026-02-15', dayText: 'Day 5', city: '大久野島/竹原', spots: [{ id: 's5-1', name: '大久野島 (兔子島)', duration: '親近動物', travelTime: '50' }, { id: 's5-2', name: '竹原街景保存地區', duration: '小京都風情', travelTime: '40' }] },
            { id: 'day6', date: '2026-02-16', dayText: 'Day 6', city: '尾道/鞆之浦', spots: [{ id: 's6-1', name: '千光寺 (纜車)', duration: '展望美景', travelTime: '30' }, { id: 's6-2', name: '貓之細道', duration: '散步', travelTime: '10' }, { id: 's6-3', name: '鞆之浦', duration: '古老漁村', travelTime: '45' }] },
            { id: 'day7', date: '2026-02-17', dayText: 'Day 7', city: '倉敷/吉備津', spots: [{ id: 's7-1', name: '倉敷美觀地區', duration: '運河老街', travelTime: '30' }, { id: 's7-2', name: '吉備津神社', duration: '長廊', travelTime: '25' }, { id: 's7-3', name: '岡山後樂園', duration: '日本三名園', travelTime: '20' }] },
            { id: 'day8', date: '2026-02-18', dayText: 'Day 8', city: '岡山/桃園', spots: [{ id: 's8-1', name: '岡山AEON Mall', duration: '最後購物', travelTime: '15' }, { id: 's8-2', name: '岡山機場 IT215 (15:55-17:40)', duration: '回程航班', travelTime: '40' }] }
        ];

        const App = () => {
            const [itinerary, setItinerary] = useState(fullItinerary);
            const [expandedDays, setExpandedDays] = useState(['day1']);
            const [bannerUrl, setBannerUrl] = useState('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&q=80&w=1200');
            const [weatherData, setWeatherData] = useState({});
            const [loadingWeather, setLoadingWeather] = useState(false);

            // 天氣預報獲取邏輯
            const fetchWeather = async () => {
                setLoadingWeather(true);
                const apiKey = ""; // 
                try {
                    const userQuery = `請提供 2026-02-11 到 2026-02-18 期間，大阪、下關、廣島、岡山等地的具體天氣預測（氣溫、狀況、穿著）。格式：{"日期": {"temp": "氣溫", "condition": "晴/陰/雨", "advice": "建議"}}`;
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) setWeatherData(JSON.parse(text));
                } catch (e) { console.error(e); }
                setLoadingWeather(false);
            };

            useEffect(() => { fetchWeather(); }, []);

            const toggleDay = (id) => {
                setExpandedDays(prev => prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]);
            };

            return (
                <div className="pb-20">
                    {/* Banner Section */}
                    <div className="relative h-64 md:h-96 w-full">
                        <img src={bannerUrl} className="w-full h-full object-cover" />
                        <div className="absolute inset-0 bg-black/40 flex flex-col items-center justify-center text-white p-4 text-center">
                            <h1 className="text-4xl md:text-6xl font-black mb-4 drop-shadow-lg">2026 家族旅行規劃</h1>
                            <p className="tracking-[0.5em] text-lg opacity-80">山陽地區・八日深度之旅</p>
                            <button onClick={() => setBannerUrl(prompt('輸入圖片網址:', bannerUrl))} className="absolute top-4 right-4 p-2 bg-white/20 rounded-full hover:bg-white/40"><i data-lucide="camera" size="20"></i></button>
                        </div>
                    </div>

                    {/* Itinerary Section */}
                    <div className="max-w-4xl mx-auto px-4 -mt-10 relative z-10 space-y-6">
                        {itinerary.map(day => {
                            const isOpen = expandedDays.includes(day.id);
                            const weather = weatherData[day.date];
                            return (
                                <div key={day.id} className="bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
                                    {/* Header */}
                                    <div onClick={() => toggleDay(day.id)} className="p-6 cursor-pointer flex flex-col md:flex-row justify-between items-center gap-4 hover:bg-gray-50 transition-colors">
                                        <div className="flex items-center gap-4 w-full md:w-auto">
                                            <div className="bg-blue-600 text-white w-14 h-14 rounded-2xl flex flex-col items-center justify-center shadow-lg">
                                                <span className="text-[10px] font-bold">{day.dayText}</span>
                                                <span className="text-lg font-bold">{day.date.split('-')[2]}</span>
                                            </div>
                                            <div>
                                                <h2 className="text-xl font-black flex items-center gap-2">{day.city}<i data-lucide="map-pin" class="w-4 h-4 text-blue-500"></i></h2>
                                                <p className="text-xs text-gray-400 font-medium">{day.date}</p>
                                            </div>
                                        </div>

                                        {/* Weather Widget */}
                                        <div className="flex items-center gap-3 bg-gray-50 p-3 rounded-2xl w-full md:w-auto border border-gray-100">
                                            {loadingWeather ? <div className="animate-spin h-4 w-4 border-2 border-blue-500 border-t-transparent rounded-full"></div> : 
                                            <div className="flex items-center gap-3">
                                                <i data-lucide="cloud-sun" class="w-6 h-6 text-orange-400"></i>
                                                <span className="font-bold text-gray-700">{weather?.temp || "5-12°C"}</span>
                                                <div className="w-px h-4 bg-gray-200 mx-1"></div>
                                                <p className="text-[11px] text-gray-500 max-w-[150px] leading-tight">{weather?.advice || "早晚涼，建議洋蔥式穿搭。"}</p>
                                            </div>}
                                            <i data-lucide={isOpen ? "chevron-up" : "chevron-down"} class="w-5 h-5 text-gray-300 ml-auto"></i>
                                        </div>
                                    </div>

                                    {/* Details */}
                                    {isOpen && <div className="px-6 pb-8 pt-2 animate-fade-in">
                                        <div className="space-y-4">
                                            {day.spots.map((spot, idx) => (
                                                <div key={spot.id}>
                                                    {idx > 0 && <div className="flex items-center gap-2 ml-10 my-2 text-[10px] font-bold text-blue-300">
                                                        <i data-lucide="car" class="w-3 h-3"></i> 預計車程 {spot.travelTime} 分鐘
                                                    </div>}
                                                    <a href={`https://www.google.com/search?q=${day.city}+${spot.name}`} target="_blank" 
                                                       className="flex items-center gap-4 p-4 bg-white border border-gray-100 rounded-2xl hover:border-blue-300 hover:shadow-md transition-all">
                                                        <div className="w-2 h-2 rounded-full bg-blue-500"></div>
                                                        <div className="flex-grow">
                                                            <div className="flex justify-between items-center">
                                                                <h3 className="font-bold text-gray-700">{spot.name}</h3>
                                                                <i data-lucide="external-link" class="w-3 h-3 text-gray-300"></i>
                                                            </div>
                                                            {spot.duration && <p className="text-[10px] text-blue-400 font-bold mt-1 uppercase tracking-tighter">{spot.duration}</p>}
                                                        </div>
                                                    </a>
                                                </div>
                                            ))}
                                        </div>
                                    </div>}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // 初始化圖示
        setTimeout(() => lucide.createIcons(), 500);
        // 每次渲染後更新圖示
        const observer = new MutationObserver(() => lucide.createIcons());
        observer.observe(document.getElementById('root'), { childList: true, subtree: true });
    </script>
</body>
</html>
