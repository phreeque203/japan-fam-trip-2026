<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 家族旅遊計畫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 使用內嵌 SVG 替代外部 Lucide 庫，避免 DOM 衝突錯誤
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                mapPin: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
                cloudSun: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M20 12h2"/><path d="m19.07 4.93-1.41 1.41"/><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"/><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"/></svg>,
                chevronDown: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>,
                chevronUp: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m18 15-6-6-6 6"/></svg>,
                car: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></svg>,
                camera: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 4h-5L7 7H4.5A2.5 2.5 0 0 0 2 9.5v9A2.5 2.5 0 0 0 4.5 21h15a2.5 2.5 0 0 0 2.5-2.5v-9A2.5 2.5 0 0 0 19.5 7H17l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
                externalLink: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>,
                info: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            };
            return icons[name] || null;
        };
        
        const fullItinerary = [
            { id: 'day1', date: '2026-02-11', dayText: 'Day 1', city: '大阪', spots: [{ id: 's1-1', name: '桃園機場 CI156 (08:10-11:35)', duration: '航班', travelTime: '0' }, { id: 's1-2', name: '大阪港 名門大洋渡輪 (19:50發)', duration: '登船', travelTime: '60' }] },
            { id: 'day2', date: '2026-02-12', dayText: 'Day 2', city: '下關/防府', spots: [{ id: 's2-1', name: '唐戶市場', duration: '海鮮美食', travelTime: '30' }, { id: 's2-2', name: '海峽夢之塔', duration: '展望台', travelTime: '15' }, { id: 's2-3', name: '關門隧道步道', duration: '跨海步行', travelTime: '20' }, { id: 's2-4', name: '防府天滿宮', duration: '神社', travelTime: '45' }] },
            { id: 'day3', date: '2026-02-13', dayText: 'Day 3', city: '岩國/宮島', spots: [{ id: 's3-1', name: '錦帶橋', duration: '木造橋', travelTime: '40' }, { id: 's3-2', name: '岩國城', duration: '天守閣', travelTime: '20' }, { id: 's3-3', name: '嚴島神社 (大鳥居)', duration: '世界遺產', travelTime: '60' }, { id: 's3-4', name: '宮島表參道商店街', duration: '購物/點心', travelTime: '10' }] },
            { id: 'day4', date: '2026-02-14', dayText: 'Day 4', city: '廣島', spots: [{ id: 's4-1', name: '原爆圓頂', duration: '歷史遺跡', travelTime: '30' }, { id: 's4-2', name: '和平紀念公園', duration: '散步', travelTime: '5' }] },
            { id: 'day5', date: '2026-02-15', dayText: 'Day 5', city: '大久野島/竹原', spots: [{ id: 's5-1', name: '大久野島 (兔子島)', duration: '親近動物', travelTime: '50' }, { id: 's5-2', name: '竹原街景保存地區', duration: '小京都風情', travelTime: '40' }] },
            { id: 'day6', date: '2026-02-16', dayText: 'Day 6', city: '尾道/鞆之浦', spots: [{ id: 's6-1', name: '千光寺 (纜車)', duration: '展望美景', travelTime: '30' }, { id: 's6-2', name: '貓之細道', duration: '散步', travelTime: '10' }, { id: 's6-3', name: '鞆之浦', duration: '古老漁村', travelTime: '45' }] },
            { id: 'day7', date: '2026-02-17', dayText: 'Day 7', city: '倉敷/吉備津', spots: [{ id: 's7-1', name: '倉敷美觀地區', duration: '運河老街', travelTime: '30' }, { id: 's7-2', name: '吉備津神社', duration: '長廊', travelTime: '25' }, { id: 's7-3', name: '岡山後樂園', duration: '日本三名園', travelTime: '20' }] },
            { id: 'day8', date: '2026-02-18', dayText: 'Day 8', city: '岡山/桃園', spots: [{ id: 's8-1', name: '岡山AEON Mall', duration: '最後購物', travelTime: '15' }, { id: 's8-2', name: '岡山機場 IT215 (15:55-17:40)', duration: '回程航班', travelTime: '40' }] }
        ];

        const App = () => {
            const [itinerary] = useState(fullItinerary);
            const [expandedDays, setExpandedDays] = useState(['day1']);
            const [bannerUrl, setBannerUrl] = useState('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&q=80&w=1200');
            const [weatherData, setWeatherData] = useState({});
            const [loadingWeather, setLoadingWeather] = useState(false);

            const fetchWeather = async () => {
                setLoadingWeather(true);
                const apiKey = ""; 
                try {
                    const userQuery = `提供 2026-02-11 到 02-18 山陽地區天氣建議。格式：{"日期": {"temp": "氣溫", "condition": "狀況", "advice": "穿著建議"}}`;
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) setWeatherData(JSON.parse(text));
                } catch (e) { 
                    console.error("Weather load error", e);
                } finally {
                    setLoadingWeather(false);
                }
            };

            useEffect(() => { fetchWeather(); }, []);

            const toggleDay = (id) => {
                setExpandedDays(prev => prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]);
            };

            return (
                <div className="pb-20">
                    <div className="relative h-64 md:h-80 w-full">
                        <img src={bannerUrl} className="w-full h-full object-cover" alt="Banner" />
                        <div className="absolute inset-0 bg-black/40 flex flex-col items-center justify-center text-white p-4">
                            <h1 className="text-4xl font-black mb-2 drop-shadow-lg text-white">2026 家族旅行</h1>
                            <p className="tracking-[0.4em] text-sm opacity-90 text-white">山陽地區深度八日遊</p>
                            <button onClick={() => setBannerUrl(prompt('圖片網址:', bannerUrl))} className="absolute top-4 right-4 p-2 bg-white/20 rounded-full hover:bg-white/40">
                                <Icon name="camera" className="w-5 h-5 text-white" />
                            </button>
                        </div>
                    </div>

                    <div className="max-w-3xl mx-auto px-4 -mt-8 relative z-10 space-y-4">
                        {itinerary.map(day => {
                            const isOpen = expandedDays.includes(day.id);
                            const weather = weatherData[day.date];
                            return (
                                <div key={day.id} className="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                                    <div className="p-5">
                                        <div onClick={() => toggleDay(day.id)} className="cursor-pointer flex items-center justify-between gap-4 mb-4">
                                            <div className="flex items-center gap-4 text-gray-800">
                                                <div className="bg-blue-600 text-white w-12 h-12 rounded-xl flex flex-col items-center justify-center font-bold shrink-0">
                                                    <span className="text-[10px] opacity-80 leading-none mb-1">{day.dayText}</span>
                                                    <span className="text-lg leading-none">{day.date.split('-')[2]}</span>
                                                </div>
                                                <div>
                                                    <h2 className="font-black flex items-center gap-1.5 text-gray-800">
                                                        {day.city}
                                                        <Icon name="mapPin" className="w-3.5 h-3.5 text-blue-500" />
                                                    </h2>
                                                    <p className="text-[10px] text-gray-400 font-bold">{day.date}</p>
                                                </div>
                                            </div>

                                            <div className="flex items-center gap-3 bg-gray-50 px-3 py-2 rounded-xl shrink-0 border border-gray-100">
                                                {loadingWeather ? (
                                                    <div className="w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                                                ) : (
                                                    <div className="flex items-center gap-2">
                                                        <Icon name="cloudSun" className="w-4 h-4 text-orange-400" />
                                                        <span className="text-xs font-bold text-gray-600">{weather?.temp || "4-11°C"}</span>
                                                    </div>
                                                )}
                                                <Icon name={isOpen ? "chevronUp" : "chevronDown"} className="w-4 h-4 text-gray-300" />
                                            </div>
                                        </div>

                                        {/* 氣候提醒文字：移到外部，摺疊與否都會顯示 */}
                                        <div className="bg-blue-50/50 border border-blue-100/50 p-3 rounded-xl flex items-start gap-3">
                                            <Icon name="info" className="w-4 h-4 text-blue-500 shrink-0 mt-0.5" />
                                            <p className="text-[11px] text-gray-600 leading-relaxed">
                                                <span className="font-bold text-blue-700">氣候提醒：</span>
                                                {weather?.advice || "日本二月寒冷，建議採洋蔥式穿法並攜帶保暖配件。"}
                                            </p>
                                        </div>
                                    </div>

                                    {isOpen && (
                                        <div className="px-5 pb-6 animate-fade-in border-t border-gray-50 pt-4 space-y-3">
                                            {day.spots.map((spot, idx) => (
                                                <div key={spot.id}>
                                                    {idx > 0 && (
                                                        <div className="flex items-center gap-2 ml-8 my-2 text-[10px] font-bold text-blue-300">
                                                            <Icon name="car" className="w-3 h-3" /> 車程 {spot.travelTime} 分
                                                        </div>
                                                    )}
                                                    <a href={`https://www.google.com/search?q=${day.city}+${spot.name}`} target="_blank" rel="noopener noreferrer"
                                                       className="flex items-center gap-4 p-4 bg-gray-50/50 rounded-xl border border-transparent hover:border-blue-100 hover:bg-blue-50/30 transition-all group">
                                                        <div className="w-1.5 h-1.5 rounded-full bg-blue-500"></div>
                                                        <div className="flex-grow">
                                                            <div className="flex justify-between items-center">
                                                                <h3 className="text-sm font-bold text-gray-700 group-hover:text-blue-600">{spot.name}</h3>
                                                                <Icon name="externalLink" className="w-3 h-3 text-gray-300" />
                                                            </div>
                                                            {spot.duration && <p className="text-[9px] text-blue-400 font-bold mt-1 tracking-wider uppercase">{spot.duration}</p>}
                                                        </div>
                                                    </a>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
